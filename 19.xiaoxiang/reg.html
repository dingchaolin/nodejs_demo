<html>
<head>
    <title>增删改查</title>

</head>
<body>

<input type="button" onclick="reg()" value="注册">
<input type="button" onclick="search()" value="查询" >
<input type="button" onclick="deleteName()" value="删除" >
<input type="button" onclick="getList()" value="显示名单" >
<table id="tableid" border="1" cellpadding="0" cellspacing="0" width="50%" >
    <thead>
    <tr>
        <td>姓名</td>
        <td>年龄</td>
    </tr>
    </thead>
    <tbody>

    </tbody>

</table>
<br>
<span colspan="6">姓名 : <input id="name" name="username" type="text" size="20%"> </span>
<span colspan="6">年龄 : <input id="age" name="age" type="text" size="20%"> </span>
</body>
<script>
    function reg() {
        var username = document.querySelector("input[name='username']").value;
        var age = document.querySelector("input[name='age']").value;
        var user = {
            username: username,
            age: age
        }
        //1.创建ajax对象 0
        var xhr = new XMLHttpRequest();
        //指定参数 1
        xhr.open('PUT', '/reg', true);
        //设置响应的类型，会自动化xhr.response转成对应的类型
        xhr.responseType = 'json';
        //注册当状态变化之后的回调函数
        xhr.onreadystatechange = function () {
            //当状态为4的时候，也就是响应接收完毕的时候
            if (xhr.readyState == 4) {
                if (xhr.status == 200) {
                    var user = xhr.response;
                    var tbody = document.querySelector("table tbody");
                    tbody.innerHTML = "";
                    for(i=0;i<user.length;i++){
                        var tr = document.createElement('tr');
                        var td1 = document.createElement('td');
                        td1.innerHTML = user[i].username;
                        var td2 = document.createElement('td');
                        td2.innerHTML = user[i].age;
                        tr.appendChild(td1);
                        tr.appendChild(td2);
                        tbody.appendChild(tr);
                    }
                } else {
                }
            }
        }
        //指定请求体发送数据
        xhr.send(JSON.stringify(user));
    }
    function deleteName() {
        var username = document.querySelector("input[name='username']").value;
        var age = document.querySelector("input[name='age']").value;
        var user = {
            username: username,
            age: age
        }
        //1.创建ajax对象 0
        var xhr = new XMLHttpRequest();
        //指定参数 1
        xhr.open('DELETE', '/reg', true);
        //设置响应的类型，会自动化xhr.response转成对应的类型
        xhr.responseType = 'json';
        //注册当状态变化之后的回调函数
        xhr.onreadystatechange = function () {
            //当状态为4的时候，也就是响应接收完毕的时候
            if (xhr.readyState == 4) {
                if (xhr.status == 200) {
                    var user = xhr.response;
                    var tbody = document.querySelector("table tbody");
                    tbody.innerHTML = "";
                    for(i=0;i<user.length;i++){
                        var tr = document.createElement('tr');
                        var td1 = document.createElement('td');
                        td1.innerHTML = user[i].username;
                        var td2 = document.createElement('td');
                        td2.innerHTML = user[i].age;
                        tr.appendChild(td1);
                        tr.appendChild(td2);
                        tbody.appendChild(tr);
                    }
                } else {
                }
            }
        }
        //指定请求体发送数据
        xhr.send(JSON.stringify(user));
    }
    function search() {
        var username = document.querySelector("input[name='username']").value;
        var age = document.querySelector("input[name='age']").value;
        var user = {
            username: username,
            age: age
        }
        //1.创建ajax对象 0
        var xhr = new XMLHttpRequest();
        //指定参数 1
        xhr.open('POST', '/reg', true);
        //设置响应的类型，会自动化xhr.response转成对应的类型
        xhr.responseType = 'json';
        //注册当状态变化之后的回调函数
        xhr.onreadystatechange = function () {
            //当状态为4的时候，也就是响应接收完毕的时候
            if (xhr.readyState == 4) {
                if (xhr.status == 200) {
                    var user = xhr.response;
                    if(user.length == 0){
                        var tbody = document.querySelector("table tbody");
                        tbody.innerHTML = "";
                        alert("查无此人");
                        return false;
                    }else{
                        var tbody = document.querySelector("table tbody");
                        tbody.innerHTML = "";
                        for(i=0;i<user.length;i++){
                            var tr = document.createElement('tr');
                            var td1 = document.createElement('td');
                            td1.innerHTML = user[i].username;
                            var td2 = document.createElement('td');
                            td2.innerHTML = user[i].age;
                            tr.appendChild(td1);
                            tr.appendChild(td2);
                            tbody.appendChild(tr);
                        }
                    }
                } else {
                }
            }
        }
        //指定请求体发送数据
        xhr.send(JSON.stringify(user));
    }
    function getList() {
        //1.创建ajax对象 0
        var xhr = new XMLHttpRequest();
        //指定参数 1
        xhr.open('GET', '/reg', true);
        //设置响应的类型，会自动化xhr.response转成对应的类型
        xhr.responseType = 'json';
        //注册当状态变化之后的回调函数
        xhr.onreadystatechange = function () {
            //当状态为4的时候，也就是响应接收完毕的时候
            if (xhr.readyState == 4) {
                if (xhr.status == 200) {
                    var user = xhr.response;
                    var tbody = document.querySelector("table tbody");
                    tbody.innerHTML = "";
                    for(i=0;i<user.length;i++){
                        var tr = document.createElement('tr');
                        var td1 = document.createElement('td');
                        td1.innerHTML = user[i].username;
                        var td2 = document.createElement('td');
                        td2.innerHTML = user[i].age;
                        tr.appendChild(td1);
                        tr.appendChild(td2);
                        tbody.appendChild(tr);
                    }
                } else {
                }
            }
        }
        //指定请求体发送数据
        xhr.send();
    }
</script>
</html>